{% extends "base.html" %}
{% load static %}

{% block title %}Сообщить о проблеме{% endblock %}

{% block additionalHead %}

<!-- Подключаем стили для FilePond -->
    <link href="https://cdn.jsdelivr.net/npm/filepond@4.30.4/dist/filepond.min.css" rel="stylesheet">
    <!-- Подключаем плагин для предпросмотра изображений -->
    <link href="https://cdn.jsdelivr.net/npm/filepond-plugin-image-preview@4.3.1/dist/filepond-plugin-image-preview.min.css" rel="stylesheet">
{% endblock %}

{% block pageTitle %}
    Сообщить о проблеме
{% endblock %}

{% block content %}
<style>
h1 {
    margin: 0;
}
/* Стили для отображения предпросмотра */

.filepond--root {
    width: 100%;
}

.filepond--item {
    width: 150px;
    flex-shrink: 0;
}
</style>

{% if not user.is_authenticated %}
<h2><a href="{% url 'users:login' %}">Для того, чтобы продолжить авторизуйтесь </a></h2>

{% else %}
<div class="steps">
    <a href="{% url 'reports:step1' %}">
        <div class="step">
            <span class="circle">1</span>
            <h2>Укажите адрес</h2>
        </div>
    </a>
    <a href="{% url 'reports:step2' %}">
        <div class="step">
            <span class="circle">2</span>
            <h2>Укажите категорию проблемы</h2>
        </div>
    </a>
    <a href="{% url 'reports:step3' %}">
        <div class="step">
            <span class="circle" style="background:#fff;">3</span>
            <h2>Опишите проблему</h2>
        </div>
    </a>
</div>

<div class="step3-container">

    <form method="POST" class="step3" action="{% url 'reports:step3' %}" enctype="multipart/form-data" id="problemForm">
        {% csrf_token %}

        <!-- Вывод ошибок формы -->
        {% if form.errors %}
            <div class="form-errors">
                <ul>
                    {% for field in form %}
                        {% if field.errors %}
                            <li>{{ field.name }}: {{ field.errors }}</li>
                        {% endif %}
                    {% endfor %}
                </ul>
            </div>
        {% endif %}

        {{ form.as_p }}
        <p class="info">ℹ️ Максимум 350 символов</p>

        <input type="file" id="filepond" class="filepond" name="file" multiple>
        <p class="info">ℹ️ Выберите или перетащите фотографию / группу фотографий. Фотографий должно быть не больше 5 штук, форматом jpg, jpeg png, heic, heif, размером не более 5 мб каждая</p>

        <button type="submit">Отправить отчет</button>
    </form>


</div>



{% endif %}

{% endblock %}



{% block scripts %}
    <script src="https://cdn.jsdelivr.net/npm/compressorjs@1.0.5/dist/compressor.min.js"></script>

    <!-- Подключаем JavaScript для FilePond и плагинов -->
    <script src="https://cdn.jsdelivr.net/npm/filepond@4.30.4/dist/filepond.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/filepond-plugin-image-preview@4.3.1/dist/filepond-plugin-image-preview.min.js"></script>

    <script src="{% static 'js/step3.js' %}"></script>

{% endblock %}